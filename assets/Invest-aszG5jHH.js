import{R as y,r as J,l as z,m as U,d as ot,e as st,_ as R,k as et,j as c,b as bt,f as ct,g as lt,u as ut,I as xt,t as G}from"./index-6YBl4HTx.js";import{d as At,s as St,S as jt,M as Pt}from"./Modal-xRkhmAXx.js";import{k as kt,e as Ot,r as nt,D as wt,H as _t,L as Z,j as W,l as Nt,A as Dt,n as F,q as Et,o as Q,s as Ct,t as It,G as Tt,v as dt,x as rt,I as Lt,y as Bt,X as pt,Y as Ft,z as Mt,B as Rt,R as $t,T as Kt}from"./useResponsive-mFIWSXW-.js";import{a as ft}from"./Card-3Pgyp4RK.js";import"./index-rlVI6WaC.js";var Vt=["type","layout","connectNulls","ref"];function D(t){"@babel/helpers - typeof";return D=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(t)}function Wt(t,e){if(t==null)return{};var r=qt(t,e),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(a=0;a<i.length;a++)n=i[a],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function qt(t,e){if(t==null)return{};var r={},n=Object.keys(t),a,i;for(i=0;i<n.length;i++)a=n[i],!(e.indexOf(a)>=0)&&(r[a]=t[a]);return r}function M(){return M=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},M.apply(this,arguments)}function at(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function b(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?at(Object(r),!0).forEach(function(n){A(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):at(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function N(t){return Zt(t)||Ht(t)||Ut(t)||zt()}function zt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ut(t,e){if(t){if(typeof t=="string")return X(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return X(t,e)}}function Ht(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Zt(t){if(Array.isArray(t))return X(t)}function X(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Gt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function it(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,mt(n.key),n)}}function Qt(t,e,r){return e&&it(t.prototype,e),r&&it(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Xt(t,e,r){return e=q(e),Yt(t,ht()?Reflect.construct(e,r||[],q(t).constructor):e.apply(t,r))}function Yt(t,e){if(e&&(D(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return k(t)}function ht(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ht=function(){return!!t})()}function q(t){return q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},q(t)}function k(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Jt(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Y(t,e)}function Y(t,e){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Y(t,e)}function A(t,e,r){return e=mt(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function mt(t){var e=te(t,"string");return D(e)=="symbol"?e:String(e)}function te(t,e){if(D(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(D(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var $=function(t){Jt(e,t);function e(){var r;Gt(this,e);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return r=Xt(this,e,[].concat(a)),A(k(r),"state",{isAnimationFinished:!0,totalLength:0}),A(k(r),"generateSimpleStrokeDasharray",function(o,s){return"".concat(s,"px ").concat(o-s,"px")}),A(k(r),"getStrokeDasharray",function(o,s,u){var l=u.reduce(function(S,P){return S+P});if(!l)return r.generateSimpleStrokeDasharray(s,o);for(var p=Math.floor(o/l),h=o%l,d=s-o,m=[],f=0,v=0;f<u.length;v+=u[f],++f)if(v+u[f]>h){m=[].concat(N(u.slice(0,f)),[h-v]);break}var x=m.length%2===0?[0,d]:[d];return[].concat(N(e.repeat(u,p)),N(m),x).map(function(S){return"".concat(S,"px")}).join(", ")}),A(k(r),"id",kt("recharts-line-")),A(k(r),"pathRef",function(o){r.mainCurve=o}),A(k(r),"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),A(k(r),"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return Qt(e,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var i=this.props,o=i.points,s=i.xAxis,u=i.yAxis,l=i.layout,p=i.children,h=_t(p,Lt);if(!h)return null;var d=function(v,x){return{x:v.x,y:v.y,value:v.value,errorVal:dt(v.payload,x)}},m={clipPath:n?"url(#clipPath-".concat(a,")"):null};return y.createElement(Z,m,h.map(function(f){return y.cloneElement(f,{key:"bar-".concat(f.props.dataKey),data:o,xAxis:s,yAxis:u,layout:l,dataPointFormatter:d})}))}},{key:"renderDots",value:function(n,a,i){var o=this.props.isAnimationActive;if(o&&!this.state.isAnimationFinished)return null;var s=this.props,u=s.dot,l=s.points,p=s.dataKey,h=W(this.props,!1),d=W(u,!0),m=l.map(function(v,x){var S=b(b(b({key:"dot-".concat(x),r:3},h),d),{},{value:v.value,dataKey:p,cx:v.x,cy:v.y,index:x,payload:v.payload});return e.renderDotItem(u,S)}),f={clipPath:n?"url(#clipPath-".concat(a?"":"dots-").concat(i,")"):null};return y.createElement(Z,M({className:"recharts-line-dots",key:"dots"},f),m)}},{key:"renderCurveStatically",value:function(n,a,i,o){var s=this.props,u=s.type,l=s.layout,p=s.connectNulls;s.ref;var h=Wt(s,Vt),d=b(b(b({},W(h,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:a?"url(#clipPath-".concat(i,")"):null,points:n},o),{},{type:u,layout:l,connectNulls:p});return y.createElement(Nt,M({},d,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,a){var i=this,o=this.props,s=o.points,u=o.strokeDasharray,l=o.isAnimationActive,p=o.animationBegin,h=o.animationDuration,d=o.animationEasing,m=o.animationId,f=o.animateNewValues,v=o.width,x=o.height,S=this.state,P=S.prevPoints,E=S.totalLength;return y.createElement(Dt,{begin:p,duration:h,isActive:l,easing:d,from:{t:0},to:{t:1},key:"line-".concat(m),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(w){var j=w.t;if(P){var C=P.length/s.length,O=s.map(function(g,H){var L=Math.floor(H*C);if(P[L]){var B=P[L],_=F(B.x,g.x),vt=F(B.y,g.y);return b(b({},g),{},{x:_(j),y:vt(j)})}if(f){var yt=F(v*2,g.x),gt=F(x/2,g.y);return b(b({},g),{},{x:yt(j),y:gt(j)})}return b(b({},g),{},{x:g.x,y:g.y})});return i.renderCurveStatically(O,n,a)}var K=F(0,E),I=K(j),T;if(u){var V="".concat(u).split(/[,\s]+/gim).map(function(g){return parseFloat(g)});T=i.getStrokeDasharray(I,E,V)}else T=i.generateSimpleStrokeDasharray(E,I);return i.renderCurveStatically(s,n,a,{strokeDasharray:T})})}},{key:"renderCurve",value:function(n,a){var i=this.props,o=i.points,s=i.isAnimationActive,u=this.state,l=u.prevPoints,p=u.totalLength;return s&&o&&o.length&&(!l&&p>0||!Et(l,o))?this.renderCurveWithAnimation(n,a):this.renderCurveStatically(o,n,a)}},{key:"render",value:function(){var n,a=this.props,i=a.hide,o=a.dot,s=a.points,u=a.className,l=a.xAxis,p=a.yAxis,h=a.top,d=a.left,m=a.width,f=a.height,v=a.isAnimationActive,x=a.id;if(i||!s||!s.length)return null;var S=this.state.isAnimationFinished,P=s.length===1,E=nt("recharts-line",u),w=l&&l.allowDataOverflow,j=p&&p.allowDataOverflow,C=w||j,O=Q(x)?this.id:x,K=(n=W(o,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},I=K.r,T=I===void 0?3:I,V=K.strokeWidth,g=V===void 0?2:V,H=Ct(o)?o:{},L=H.clipDot,B=L===void 0?!0:L,_=T*2+g;return y.createElement(Z,{className:E},w||j?y.createElement("defs",null,y.createElement("clipPath",{id:"clipPath-".concat(O)},y.createElement("rect",{x:w?d:d-m/2,y:j?h:h-f/2,width:w?m:m*2,height:j?f:f*2})),!B&&y.createElement("clipPath",{id:"clipPath-dots-".concat(O)},y.createElement("rect",{x:d-_/2,y:h-_/2,width:m+_,height:f+_}))):null,!P&&this.renderCurve(C,O),this.renderErrorBar(C,O),(P||o)&&this.renderDots(C,B,O),(!v||S)&&It.renderCallByParent(this.props,s))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:a.curPoints}:n.points!==a.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,a){for(var i=n.length%2!==0?[].concat(N(n),[0]):n,o=[],s=0;s<a;++s)o=[].concat(N(o),N(i));return o}},{key:"renderDotItem",value:function(n,a){var i;if(y.isValidElement(n))i=y.cloneElement(n,a);else if(Ot(n))i=n(a);else{var o=nt("recharts-line-dot",n?n.className:"");i=y.createElement(wt,M({},a,{className:o}))}return i}}]),e}(J.PureComponent);A($,"displayName","Line");A($,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Tt.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});A($,"getComposedData",function(t){var e=t.props,r=t.xAxis,n=t.yAxis,a=t.xAxisTicks,i=t.yAxisTicks,o=t.dataKey,s=t.bandSize,u=t.displayedData,l=t.offset,p=e.layout,h=u.map(function(d,m){var f=dt(d,o);return p==="horizontal"?{x:rt({axis:r,ticks:a,bandSize:s,entry:d,index:m}),y:Q(f)?null:n.scale(f),value:f,payload:d}:{x:Q(f)?null:r.scale(f),y:rt({axis:n,ticks:i,bandSize:s,entry:d,index:m}),value:f,payload:d}});return b({points:h,layout:p},l)});var ee=Bt({chartName:"LineChart",GraphicalChild:$,axisComponents:[{axisType:"xAxis",AxisComp:pt},{axisType:"yAxis",AxisComp:Ft}],formatAxisMap:Mt});async function ne(t){try{return await z(`${U}/invest/add-stock`,"POST",t)}catch(e){throw console.log(e),e}}async function re(){try{return{data:await z(`${U}/invest/see-stocks`,"GET")}}catch(t){throw console.log(t),t}}async function ae(){try{return{data:await z(`${U}/invest/`,"GET")}}catch(t){throw console.log(t),t}}async function ie(t){try{return await z(`${U}/invest/sell-stock`,"PATCH",t)}catch(e){throw console.log(e),e}}function oe(){const t=ot(),{isPending:e,mutate:r}=st({mutationFn:n=>ie(n),onSuccess:()=>{R.success("Stocks sold successfully",{className:"toast"}),t.invalidateQueries({queryKey:["stocks"]})},onError:n=>R.error(n.message,{className:"toast"})});return{isSelling:e,sellStock:r}}function tt(){const{data:t,isLoading:e,refetch:r}=et({queryKey:["stocks"],queryFn:re}),{data:n,isLoading:a}=et({queryKey:["availableStocks"],queryFn:ae}),i=t==null?void 0:t.data,o=n==null?void 0:n.data;return{stocks:i,loading:e||a,availableStocks:o,refetchStocks:r}}function se(t,e,r){const{availableStocks:n}=tt(),a=n==null?void 0:n.find(s=>s._id===t),i=a?e*a.currentValue>e*r:!1,o=a&&e*a.currentValue;return{stock:a,profit:i,profitAmount:o}}function ce({amount:t,boughtPrice:e,i:r,stockId:n,cardId:a,sellPriceId:i,name:o}){const{isSelling:s,sellStock:u}=oe(),{stock:l,profit:p,profitAmount:h}=se(i,t,e),d={amount:t,_id:n,sellPrice:l==null?void 0:l.currentValue,cardId:a};function m(){u(d)}return c.jsxs("div",{className:"transaction-table-row",children:[c.jsx("p",{className:"transaction-table-row-item",children:o}),c.jsx("p",{className:`transaction-table-row-item ${p?"text-green":"text-red"}`,children:t}),c.jsx("p",{className:"transaction-table-row-item",children:e}),c.jsx("p",{className:"transaction-table-row-item",children:l?h==null?void 0:h.toFixed(2):"N/A"}),c.jsx("div",{className:"transaction-table-row-item",children:c.jsx("button",{className:"btn",onClick:m,disabled:s,children:"Sell All"})})]},r)}const le=["Name","Amount","Bought Price","Sell Price","Sell"],ue=[{value:"amount-asc",label:"Sort by amount (A-Z)"},{value:"amount-desc",label:"Sort by amount (Z-A)"},{value:"name-asc",label:"Sort by name (A-Z)"},{value:"name-desc",label:"Sort by name (Z-A)"},{value:"boughtPrice-asc",label:"Sort by bought price (A-Z)"},{value:"boughtPrice-desc",label:"Sort by bought price (Z-A)"}],de="Please buy a stock";function pe(){const[t]=bt(),{stocks:e,loading:r}=tt(),n=t.get("sortBy")||"amount-asc",[a,i]=n.split("-"),o=At(e,r,de),s=St(e,a,i),u=ct(lt);return c.jsxs("div",{className:"transaction-table transaction-table-invest",children:[c.jsx(jt,{title:"Owned stocks",options:ue}),c.jsx("div",{className:"transaction-table-row",children:le.map(l=>c.jsx("div",{className:"transaction-table-row-item",children:l},l))}),o,s==null?void 0:s.map((l,p)=>c.jsx(ce,{amount:l.amount,i:p,boughtPrice:l.boughtPrice,stockId:l._id,cardId:u._id,sellPriceId:l.stockId,name:l.name},p))]})}const fe=-30,he=1800,me="#8884d8";function ve(t){return t.previousValue.slice(fe).map((r,n)=>({previousValue:r,index:n+1}))}function ye({data:t}){const e=Rt(he),r=ve(t);return c.jsx("div",{className:"stock-line-chart",children:c.jsx($t,{width:e?350:"100%",height:e?200:"100%",children:c.jsxs(ee,{data:r,children:[c.jsx(pt,{dataKey:"index"}),c.jsx(Kt,{}),c.jsx($,{type:"monotone",dataKey:"previousValue",stroke:me})]})})})}function ge(){const t=ot(),{isPending:e,mutate:r}=st({mutationFn:n=>ne(n),onSuccess:()=>{R.success("Use them wisely",{className:"toast"}),t.invalidateQueries({queryKey:["stocks"]})},onError:n=>R.error(n.message,{className:"toast"})});return{isAdding:e,buyStock:r}}function be({_id:t,name:e,currentValue:r}){const[n,a]=J.useState(""),i=ct(lt),o=ut(),{isAdding:s,buyStock:u}=ge(),l={_id:t,name:e,boughtPrice:r,amount:+n,cardId:i._id},p=+n;console.log(l);async function h(d){if(d.preventDefault(),p*r>i.balance){R.error("Insufficient funds",{className:"toast"});return}u(l),o(G({modalId:"stock",open:!1}))}return c.jsxs("div",{children:[c.jsx("div",{className:"card-transactions-container",children:c.jsx(ft,{})}),c.jsxs("form",{className:"form-transactions",onSubmit:d=>h(d),children:[c.jsx(xt,{type:"number",id:"amount",value:n,onChange:d=>a(d.target.value)}),c.jsx("div",{className:"form-stocks",children:c.jsx("span",{className:p*r>i.balance?"form-error":void 0,children:p>0&&`Invest ${(p*r).toFixed(2)}$ in ${e}`})}),c.jsx("div",{className:"form-btn",children:c.jsx("button",{className:"btn btn-form",disabled:!i._id||s,children:"Invest"})})]})]})}function xe({currentValue:t,name:e,previousValue:r,_id:n}){const a=ut(),[i,o]=J.useState(!1);function s(){o(!0),a(G({modalId:"stock",open:!0}))}function u(){o(!1),a(G({modalId:"stock",open:!1}))}return c.jsxs("div",{className:"invest-card",children:[c.jsx(ye,{data:{previousValue:r}}),c.jsxs("div",{className:"invest-data",children:[c.jsx("div",{className:"invest-card-description",children:c.jsx("h3",{children:e})}),c.jsx("div",{className:"invest-card-amount",children:c.jsxs("span",{children:["Current value ",t]})}),c.jsx("button",{className:"btn btn-login",onClick:s,children:"Invest"})]}),i&&c.jsx(Pt,{modalId:"stock",handleCloseModal:u,children:c.jsx(be,{_id:n,name:e,currentValue:t})})]})}function Ae(){const{availableStocks:t}=tt();return c.jsx("div",{className:"stocks-container",children:t==null?void 0:t.map(e=>c.jsx(xe,{currentValue:e.currentValue,previousValue:e.previousValue,changePercent:e.changePercent,name:e.name,_id:e._id},e.name))})}function we(){return c.jsx("div",{className:"main-page-container",children:c.jsxs("div",{className:"main-page",children:[c.jsx(ft,{}),c.jsx(pe,{}),c.jsx(Ae,{})]})})}export{we as default};
