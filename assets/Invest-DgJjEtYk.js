import{R as g,r as ot,q as W,v as z,d as st,e as ct,_ as V,p as et,j as c,b as xt,g as lt,h as ut,u as dt,i as At,k as St,I as jt,o as Pt,f as kt,t as G}from"./index-DtgqOgN9.js";import{d as Ot,s as wt,S as Nt,M as _t}from"./Modal-Brg6okiw.js";import{k as Dt,e as Et,r as nt,D as Tt,H as Ct,L as Z,j as U,l as It,A as Lt,n as B,q as Mt,o as Q,s as Bt,t as Ft,G as Rt,v as pt,x as rt,I as $t,y as Kt,X as mt,Y as Ut,z as Vt,B as qt,R as Wt,T as zt}from"./useResponsive-DWud6Age.js";import{C as ft}from"./Card-CzQTCcNt.js";var Ht=["type","layout","connectNulls","ref"];function D(t){"@babel/helpers - typeof";return D=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(t)}function Zt(t,e){if(t==null)return{};var r=Gt(t,e),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(a=0;a<o.length;a++)n=o[a],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function Gt(t,e){if(t==null)return{};var r={},n=Object.keys(t),a,o;for(o=0;o<n.length;o++)a=n[o],!(e.indexOf(a)>=0)&&(r[a]=t[a]);return r}function F(){return F=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},F.apply(this,arguments)}function at(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function A(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?at(Object(r),!0).forEach(function(n){S(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):at(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function _(t){return Jt(t)||Yt(t)||Xt(t)||Qt()}function Qt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xt(t,e){if(t){if(typeof t=="string")return X(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return X(t,e)}}function Yt(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Jt(t){if(Array.isArray(t))return X(t)}function X(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function te(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function it(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,vt(n.key),n)}}function ee(t,e,r){return e&&it(t.prototype,e),r&&it(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function ne(t,e,r){return e=q(e),re(t,ht()?Reflect.construct(e,r||[],q(t).constructor):e.apply(t,r))}function re(t,e){if(e&&(D(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return k(t)}function ht(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ht=function(){return!!t})()}function q(t){return q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},q(t)}function k(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ae(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Y(t,e)}function Y(t,e){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Y(t,e)}function S(t,e,r){return e=vt(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function vt(t){var e=ie(t,"string");return D(e)=="symbol"?e:String(e)}function ie(t,e){if(D(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(D(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var R=function(t){ae(e,t);function e(){var r;te(this,e);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return r=ne(this,e,[].concat(a)),S(k(r),"state",{isAnimationFinished:!0,totalLength:0}),S(k(r),"generateSimpleStrokeDasharray",function(i,s){return"".concat(s,"px ").concat(i-s,"px")}),S(k(r),"getStrokeDasharray",function(i,s,u){var l=u.reduce(function(b,P){return b+P});if(!l)return r.generateSimpleStrokeDasharray(s,i);for(var m=Math.floor(i/l),f=i%l,d=s-i,h=[],p=0,v=0;p<u.length;v+=u[p],++p)if(v+u[p]>f){h=[].concat(_(u.slice(0,p)),[f-v]);break}var y=h.length%2===0?[0,d]:[d];return[].concat(_(e.repeat(u,m)),_(h),y).map(function(b){return"".concat(b,"px")}).join(", ")}),S(k(r),"id",Dt("recharts-line-")),S(k(r),"pathRef",function(i){r.mainCurve=i}),S(k(r),"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),S(k(r),"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return ee(e,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,i=o.points,s=o.xAxis,u=o.yAxis,l=o.layout,m=o.children,f=Ct(m,$t);if(!f)return null;var d=function(v,y){return{x:v.x,y:v.y,value:v.value,errorVal:pt(v.payload,y)}},h={clipPath:n?"url(#clipPath-".concat(a,")"):null};return g.createElement(Z,h,f.map(function(p){return g.cloneElement(p,{key:"bar-".concat(p.props.dataKey),data:i,xAxis:s,yAxis:u,layout:l,dataPointFormatter:d})}))}},{key:"renderDots",value:function(n,a,o){var i=this.props.isAnimationActive;if(i&&!this.state.isAnimationFinished)return null;var s=this.props,u=s.dot,l=s.points,m=s.dataKey,f=U(this.props,!1),d=U(u,!0),h=l.map(function(v,y){var b=A(A(A({key:"dot-".concat(y),r:3},f),d),{},{value:v.value,dataKey:m,cx:v.x,cy:v.y,index:y,payload:v.payload});return e.renderDotItem(u,b)}),p={clipPath:n?"url(#clipPath-".concat(a?"":"dots-").concat(o,")"):null};return g.createElement(Z,F({className:"recharts-line-dots",key:"dots"},p),h)}},{key:"renderCurveStatically",value:function(n,a,o,i){var s=this.props,u=s.type,l=s.layout,m=s.connectNulls;s.ref;var f=Zt(s,Ht),d=A(A(A({},U(f,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:a?"url(#clipPath-".concat(o,")"):null,points:n},i),{},{type:u,layout:l,connectNulls:m});return g.createElement(It,F({},d,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,a){var o=this,i=this.props,s=i.points,u=i.strokeDasharray,l=i.isAnimationActive,m=i.animationBegin,f=i.animationDuration,d=i.animationEasing,h=i.animationId,p=i.animateNewValues,v=i.width,y=i.height,b=this.state,P=b.prevPoints,E=b.totalLength;return g.createElement(Lt,{begin:m,duration:f,isActive:l,easing:d,from:{t:0},to:{t:1},key:"line-".concat(h),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(w){var j=w.t;if(P){var T=P.length/s.length,O=s.map(function(x,H){var L=Math.floor(H*T);if(P[L]){var M=P[L],N=B(M.x,x.x),yt=B(M.y,x.y);return A(A({},x),{},{x:N(j),y:yt(j)})}if(p){var bt=B(v*2,x.x),gt=B(y/2,x.y);return A(A({},x),{},{x:bt(j),y:gt(j)})}return A(A({},x),{},{x:x.x,y:x.y})});return o.renderCurveStatically(O,n,a)}var $=B(0,E),C=$(j),I;if(u){var K="".concat(u).split(/[,\s]+/gim).map(function(x){return parseFloat(x)});I=o.getStrokeDasharray(C,E,K)}else I=o.generateSimpleStrokeDasharray(E,C);return o.renderCurveStatically(s,n,a,{strokeDasharray:I})})}},{key:"renderCurve",value:function(n,a){var o=this.props,i=o.points,s=o.isAnimationActive,u=this.state,l=u.prevPoints,m=u.totalLength;return s&&i&&i.length&&(!l&&m>0||!Mt(l,i))?this.renderCurveWithAnimation(n,a):this.renderCurveStatically(i,n,a)}},{key:"render",value:function(){var n,a=this.props,o=a.hide,i=a.dot,s=a.points,u=a.className,l=a.xAxis,m=a.yAxis,f=a.top,d=a.left,h=a.width,p=a.height,v=a.isAnimationActive,y=a.id;if(o||!s||!s.length)return null;var b=this.state.isAnimationFinished,P=s.length===1,E=nt("recharts-line",u),w=l&&l.allowDataOverflow,j=m&&m.allowDataOverflow,T=w||j,O=Q(y)?this.id:y,$=(n=U(i,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},C=$.r,I=C===void 0?3:C,K=$.strokeWidth,x=K===void 0?2:K,H=Bt(i)?i:{},L=H.clipDot,M=L===void 0?!0:L,N=I*2+x;return g.createElement(Z,{className:E},w||j?g.createElement("defs",null,g.createElement("clipPath",{id:"clipPath-".concat(O)},g.createElement("rect",{x:w?d:d-h/2,y:j?f:f-p/2,width:w?h:h*2,height:j?p:p*2})),!M&&g.createElement("clipPath",{id:"clipPath-dots-".concat(O)},g.createElement("rect",{x:d-N/2,y:f-N/2,width:h+N,height:p+N}))):null,!P&&this.renderCurve(T,O),this.renderErrorBar(T,O),(P||i)&&this.renderDots(T,M,O),(!v||b)&&Ft.renderCallByParent(this.props,s))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:a.curPoints}:n.points!==a.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,a){for(var o=n.length%2!==0?[].concat(_(n),[0]):n,i=[],s=0;s<a;++s)i=[].concat(_(i),_(o));return i}},{key:"renderDotItem",value:function(n,a){var o;if(g.isValidElement(n))o=g.cloneElement(n,a);else if(Et(n))o=n(a);else{var i=nt("recharts-line-dot",n?n.className:"");o=g.createElement(Tt,F({},a,{className:i}))}return o}}]),e}(ot.PureComponent);S(R,"displayName","Line");S(R,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Rt.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});S(R,"getComposedData",function(t){var e=t.props,r=t.xAxis,n=t.yAxis,a=t.xAxisTicks,o=t.yAxisTicks,i=t.dataKey,s=t.bandSize,u=t.displayedData,l=t.offset,m=e.layout,f=u.map(function(d,h){var p=pt(d,i);return m==="horizontal"?{x:rt({axis:r,ticks:a,bandSize:s,entry:d,index:h}),y:Q(p)?null:n.scale(p),value:p,payload:d}:{x:Q(p)?null:r.scale(p),y:rt({axis:n,ticks:o,bandSize:s,entry:d,index:h}),value:p,payload:d}});return A({points:f,layout:m},l)});var oe=Kt({chartName:"LineChart",GraphicalChild:R,axisComponents:[{axisType:"xAxis",AxisComp:mt},{axisType:"yAxis",AxisComp:Ut}],formatAxisMap:Vt});async function se(t){try{return await W(`${z}/invest/add-stock`,"POST",t)}catch(e){throw console.log(e),e}}async function ce(){try{return{data:await W(`${z}/invest/see-stocks`,"GET")}}catch(t){throw console.log(t),t}}async function le(){try{return{data:await W(`${z}/invest/`,"GET")}}catch(t){throw console.log(t),t}}async function ue(t){try{return await W(`${z}/invest/sell-stock`,"PATCH",t)}catch(e){throw console.log(e),e}}function de(){const t=st(),{isPending:e,mutate:r}=ct({mutationFn:n=>ue(n),onSuccess:()=>{V.success("Stocks sold successfully",{className:"toast"}),t.invalidateQueries({queryKey:["stocks"]})},onError:n=>V.error(n.message,{className:"toast"})});return{isSelling:e,sellStock:r}}function tt(){const{data:t,isLoading:e,refetch:r}=et({queryKey:["stocks"],queryFn:ce}),{data:n,isLoading:a}=et({queryKey:["availableStocks"],queryFn:le}),o=t==null?void 0:t.data,i=n==null?void 0:n.data;return{stocks:o,loading:e||a,availableStocks:i,refetchStocks:r}}function pe(t,e,r){const{availableStocks:n}=tt(),a=n==null?void 0:n.find(s=>s._id===t),o=a?e*a.currentValue>e*r:!1,i=a&&e*a.currentValue;return{stock:a,profit:o,profitAmount:i}}function me({amount:t,boughtPrice:e,i:r,stockId:n,cardId:a,sellPriceId:o,name:i}){const{isSelling:s,sellStock:u}=de(),{stock:l,profit:m,profitAmount:f}=pe(o,t,e),d={amount:t,_id:n,sellPrice:l==null?void 0:l.currentValue,cardId:a};function h(){u(d)}return c.jsxs("div",{className:"transaction-table-row",children:[c.jsx("p",{className:"transaction-table-row-item",children:i}),c.jsx("p",{className:`transaction-table-row-item ${m?"text-green":"text-red"}`,children:t}),c.jsx("p",{className:"transaction-table-row-item",children:e}),c.jsx("p",{className:"transaction-table-row-item",children:l?f==null?void 0:f.toFixed(2):"N/A"}),c.jsx("div",{className:"transaction-table-row-item",children:c.jsx("button",{className:"btn",onClick:h,disabled:s,children:"Sell All"})})]},r)}const fe=["Name","Amount","Bought Price","Sell Price","Sell"],he=[{value:"amount-asc",label:"Sort by amount (A-Z)"},{value:"amount-desc",label:"Sort by amount (Z-A)"},{value:"name-asc",label:"Sort by name (A-Z)"},{value:"name-desc",label:"Sort by name (Z-A)"},{value:"boughtPrice-asc",label:"Sort by bought price (A-Z)"},{value:"boughtPrice-desc",label:"Sort by bought price (Z-A)"}],ve="Please buy a stock";function ye(){const[t]=xt(),{stocks:e,loading:r}=tt(),n=t.get("sortBy")||"amount-asc",[a,o]=n.split("-"),i=Ot(e,r,ve),s=wt(e,a,o),u=lt(ut);return c.jsxs("div",{className:"transaction-table transaction-table-invest",children:[c.jsx(Nt,{title:"Owned stocks",options:he}),c.jsx("div",{className:"transaction-table-row",children:fe.map(l=>c.jsx("div",{className:"transaction-table-row-item",children:l},l))}),i,s==null?void 0:s.map((l,m)=>c.jsx(me,{amount:l.amount,i:m,boughtPrice:l.boughtPrice,stockId:l._id,cardId:u._id,sellPriceId:l.stockId,name:l.name},m))]})}const be=-30,ge=1800,xe="#8884d8";function Ae(t){return t.previousValue.slice(be).map((r,n)=>({previousValue:r,index:n+1}))}function Se({data:t}){const e=qt(ge),r=Ae(t);return c.jsx("div",{className:"stock-line-chart",children:c.jsx(Wt,{width:e?350:"100%",height:e?200:"100%",children:c.jsxs(oe,{data:r,children:[c.jsx(mt,{dataKey:"index"}),c.jsx(zt,{}),c.jsx(R,{type:"monotone",dataKey:"previousValue",stroke:xe})]})})})}function je(){const t=st(),{isPending:e,mutate:r}=ct({mutationFn:n=>se(n),onSuccess:()=>{V.success("Use them wisely",{className:"toast"}),t.invalidateQueries({queryKey:["stocks"]})},onError:n=>V.error(n.message,{className:"toast"})});return{isAdding:e,buyStock:r}}const J={AMOUNT:"amount"},Pe={AMOUNT:"Enter your amount"},ke=Pt({[J.AMOUNT]:kt().min(1,{message:"Required"})});function Oe({_id:t,name:e,currentValue:r}){const n=lt(ut),a=dt(),{isAdding:o,buyStock:i}=je(),{register:s,handleSubmit:u,watch:l,formState:{errors:m}}=At({defaultValues:{[J.AMOUNT]:""},resolver:St(ke)}),[f]=l(["amount"]),d=+f,h=d*r>n.balance,p=y=>{console.log(y);const b={amount:+y.amount,_id:t,name:e,boughtPrice:r,cardId:n._id};i(b),a(G({modalId:"stock",open:!1}))},v=[{name:J.AMOUNT,label:Pe.AMOUNT,type:"number"}];return c.jsxs("div",{children:[c.jsx("div",{className:"card-transactions-container",children:c.jsx(ft,{})}),c.jsxs("form",{className:"form-transactions",onSubmit:u(p),children:[v.map((y,b)=>c.jsx(jt,{id:y.name,name:y.name,register:s,errors:m,placeholder:y.label,type:y.type},b)),c.jsx("div",{className:"form-stocks",children:c.jsx("span",{className:d*r>n.balance?"form-error":void 0,children:d>0&&`Invest ${(d*r).toFixed(2)}$ in ${e}`})}),c.jsx("div",{className:"form-btn",children:c.jsx("button",{className:"btn btn-form",disabled:!n._id||o||h,children:"Invest"})})]})]})}function we({currentValue:t,name:e,previousValue:r,_id:n}){const a=dt(),[o,i]=ot.useState(!1);function s(){i(!0),a(G({modalId:"stock",open:!0}))}function u(){i(!1),a(G({modalId:"stock",open:!1}))}return c.jsxs("div",{className:"invest-card",children:[c.jsx(Se,{data:{previousValue:r}}),c.jsxs("div",{className:"invest-data",children:[c.jsx("div",{className:"invest-card-description",children:c.jsx("h3",{children:e})}),c.jsx("div",{className:"invest-card-amount",children:c.jsxs("span",{children:["Current value ",t]})}),c.jsx("button",{className:"btn btn-login",onClick:s,children:"Invest"})]}),o&&c.jsx(_t,{modalId:"stock",handleCloseModal:u,children:c.jsx(Oe,{_id:n,name:e,currentValue:t})})]})}function Ne(){const{availableStocks:t}=tt();return c.jsx("div",{className:"stocks-container",children:t==null?void 0:t.map(e=>c.jsx(we,{currentValue:e.currentValue,previousValue:e.previousValue,changePercent:e.changePercent,name:e.name,_id:e._id},e.name))})}function Ce(){return c.jsx("div",{className:"main-page-container",children:c.jsxs("div",{className:"main-page",children:[c.jsx(ft,{}),c.jsx(ye,{}),c.jsx(Ne,{})]})})}export{Ce as default};
