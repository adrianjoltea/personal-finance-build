import{R as g,r as st,d as q,e as z,h as ct,i as lt,_ as U,c as nt,a as tt,j as c,u as At,b as ut,k as dt,l as pt,m as St,t as jt,I as Pt,o as Ot,s as kt,n as G}from"./index-pnElvbLb.js";import{d as wt,s as Nt,S as _t,u as Tt,M as Dt}from"./dataStates-DsF0VMBj.js";import{t as Et,C as mt}from"./translateData-BVr0GJ1P.js";import{u as It}from"./useResponsive-CmKXr6lX.js";import{k as Ct,e as Lt,r as at,D as Mt,F as $t,L as Z,j as V,l as Ft,A as Bt,n as $,q as Rt,o as Q,s as Kt,t as Vt,G as Ut,v as ft,x as rt,H as Wt,y as qt,X as ht,Y as zt,z as Ht,R as Zt,T as Gt}from"./generateCategoricalChart-CmDExwW6.js";var Qt=["type","layout","connectNulls","ref"];function T(t){"@babel/helpers - typeof";return T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(t)}function Xt(t,e){if(t==null)return{};var a=Yt(t,e),n,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}function Yt(t,e){if(t==null)return{};var a={},n=Object.keys(t),r,o;for(o=0;o<n.length;o++)r=n[o],!(e.indexOf(r)>=0)&&(a[r]=t[r]);return a}function F(){return F=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},F.apply(this,arguments)}function it(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),a.push.apply(a,n)}return a}function S(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?it(Object(a),!0).forEach(function(n){j(t,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):it(Object(a)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(a,n))})}return t}function _(t){return ne(t)||ee(t)||te(t)||Jt()}function Jt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function te(t,e){if(t){if(typeof t=="string")return X(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);if(a==="Object"&&t.constructor&&(a=t.constructor.name),a==="Map"||a==="Set")return Array.from(t);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return X(t,e)}}function ee(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function ne(t){if(Array.isArray(t))return X(t)}function X(t,e){(e==null||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function ae(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ot(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,yt(n.key),n)}}function re(t,e,a){return e&&ot(t.prototype,e),a&&ot(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function ie(t,e,a){return e=W(e),oe(t,vt()?Reflect.construct(e,a||[],W(t).constructor):e.apply(t,a))}function oe(t,e){if(e&&(T(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return O(t)}function vt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vt=function(){return!!t})()}function W(t){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},W(t)}function O(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function se(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Y(t,e)}function Y(t,e){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},Y(t,e)}function j(t,e,a){return e=yt(e),e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function yt(t){var e=ce(t,"string");return T(e)=="symbol"?e:String(e)}function ce(t,e){if(T(t)!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var n=a.call(t,e||"default");if(T(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var B=function(t){se(e,t);function e(){var a;ae(this,e);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return a=ie(this,e,[].concat(r)),j(O(a),"state",{isAnimationFinished:!0,totalLength:0}),j(O(a),"generateSimpleStrokeDasharray",function(i,s){return"".concat(s,"px ").concat(i-s,"px")}),j(O(a),"getStrokeDasharray",function(i,s,u){var d=u.reduce(function(y,x){return y+x});if(!d)return a.generateSimpleStrokeDasharray(s,i);for(var h=Math.floor(i/d),l=i%d,m=s-i,f=[],p=0,v=0;p<u.length;v+=u[p],++p)if(v+u[p]>l){f=[].concat(_(u.slice(0,p)),[l-v]);break}var b=f.length%2===0?[0,m]:[m];return[].concat(_(e.repeat(u,h)),_(f),b).map(function(y){return"".concat(y,"px")}).join(", ")}),j(O(a),"id",Ct("recharts-line-")),j(O(a),"pathRef",function(i){a.mainCurve=i}),j(O(a),"handleAnimationEnd",function(){a.setState({isAnimationFinished:!0}),a.props.onAnimationEnd&&a.props.onAnimationEnd()}),j(O(a),"handleAnimationStart",function(){a.setState({isAnimationFinished:!1}),a.props.onAnimationStart&&a.props.onAnimationStart()}),a}return re(e,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,r){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,i=o.points,s=o.xAxis,u=o.yAxis,d=o.layout,h=o.children,l=$t(h,Wt);if(!l)return null;var m=function(v,b){return{x:v.x,y:v.y,value:v.value,errorVal:ft(v.payload,b)}},f={clipPath:n?"url(#clipPath-".concat(r,")"):null};return g.createElement(Z,f,l.map(function(p){return g.cloneElement(p,{key:"bar-".concat(p.props.dataKey),data:i,xAxis:s,yAxis:u,layout:d,dataPointFormatter:m})}))}},{key:"renderDots",value:function(n,r,o){var i=this.props.isAnimationActive;if(i&&!this.state.isAnimationFinished)return null;var s=this.props,u=s.dot,d=s.points,h=s.dataKey,l=V(this.props,!1),m=V(u,!0),f=d.map(function(v,b){var y=S(S(S({key:"dot-".concat(b),r:3},l),m),{},{value:v.value,dataKey:h,cx:v.x,cy:v.y,index:b,payload:v.payload});return e.renderDotItem(u,y)}),p={clipPath:n?"url(#clipPath-".concat(r?"":"dots-").concat(o,")"):null};return g.createElement(Z,F({className:"recharts-line-dots",key:"dots"},p),f)}},{key:"renderCurveStatically",value:function(n,r,o,i){var s=this.props,u=s.type,d=s.layout,h=s.connectNulls;s.ref;var l=Xt(s,Qt),m=S(S(S({},V(l,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:r?"url(#clipPath-".concat(o,")"):null,points:n},i),{},{type:u,layout:d,connectNulls:h});return g.createElement(Ft,F({},m,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,r){var o=this,i=this.props,s=i.points,u=i.strokeDasharray,d=i.isAnimationActive,h=i.animationBegin,l=i.animationDuration,m=i.animationEasing,f=i.animationId,p=i.animateNewValues,v=i.width,b=i.height,y=this.state,x=y.prevPoints,D=y.totalLength;return g.createElement(Bt,{begin:h,duration:l,isActive:d,easing:m,from:{t:0},to:{t:1},key:"line-".concat(f),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(w){var P=w.t;if(x){var E=x.length/s.length,k=s.map(function(A,H){var L=Math.floor(H*E);if(x[L]){var M=x[L],N=$(M.x,A.x),gt=$(M.y,A.y);return S(S({},A),{},{x:N(P),y:gt(P)})}if(p){var bt=$(v*2,A.x),xt=$(b/2,A.y);return S(S({},A),{},{x:bt(P),y:xt(P)})}return S(S({},A),{},{x:A.x,y:A.y})});return o.renderCurveStatically(k,n,r)}var R=$(0,D),I=R(P),C;if(u){var K="".concat(u).split(/[,\s]+/gim).map(function(A){return parseFloat(A)});C=o.getStrokeDasharray(I,D,K)}else C=o.generateSimpleStrokeDasharray(D,I);return o.renderCurveStatically(s,n,r,{strokeDasharray:C})})}},{key:"renderCurve",value:function(n,r){var o=this.props,i=o.points,s=o.isAnimationActive,u=this.state,d=u.prevPoints,h=u.totalLength;return s&&i&&i.length&&(!d&&h>0||!Rt(d,i))?this.renderCurveWithAnimation(n,r):this.renderCurveStatically(i,n,r)}},{key:"render",value:function(){var n,r=this.props,o=r.hide,i=r.dot,s=r.points,u=r.className,d=r.xAxis,h=r.yAxis,l=r.top,m=r.left,f=r.width,p=r.height,v=r.isAnimationActive,b=r.id;if(o||!s||!s.length)return null;var y=this.state.isAnimationFinished,x=s.length===1,D=at("recharts-line",u),w=d&&d.allowDataOverflow,P=h&&h.allowDataOverflow,E=w||P,k=Q(b)?this.id:b,R=(n=V(i,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},I=R.r,C=I===void 0?3:I,K=R.strokeWidth,A=K===void 0?2:K,H=Kt(i)?i:{},L=H.clipDot,M=L===void 0?!0:L,N=C*2+A;return g.createElement(Z,{className:D},w||P?g.createElement("defs",null,g.createElement("clipPath",{id:"clipPath-".concat(k)},g.createElement("rect",{x:w?m:m-f/2,y:P?l:l-p/2,width:w?f:f*2,height:P?p:p*2})),!M&&g.createElement("clipPath",{id:"clipPath-dots-".concat(k)},g.createElement("rect",{x:m-N/2,y:l-N/2,width:f+N,height:p+N}))):null,!x&&this.renderCurve(E,k),this.renderErrorBar(E,k),(x||i)&&this.renderDots(E,M,k),(!v||y)&&Vt.renderCallByParent(this.props,s))}}],[{key:"getDerivedStateFromProps",value:function(n,r){return n.animationId!==r.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:r.curPoints}:n.points!==r.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,r){for(var o=n.length%2!==0?[].concat(_(n),[0]):n,i=[],s=0;s<r;++s)i=[].concat(_(i),_(o));return i}},{key:"renderDotItem",value:function(n,r){var o;if(g.isValidElement(n))o=g.cloneElement(n,r);else if(Lt(n))o=n(r);else{var i=at("recharts-line-dot",n?n.className:"");o=g.createElement(Mt,F({},r,{className:i}))}return o}}]),e}(st.PureComponent);j(B,"displayName","Line");j(B,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Ut.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});j(B,"getComposedData",function(t){var e=t.props,a=t.xAxis,n=t.yAxis,r=t.xAxisTicks,o=t.yAxisTicks,i=t.dataKey,s=t.bandSize,u=t.displayedData,d=t.offset,h=e.layout,l=u.map(function(m,f){var p=ft(m,i);return h==="horizontal"?{x:rt({axis:a,ticks:r,bandSize:s,entry:m,index:f}),y:Q(p)?null:n.scale(p),value:p,payload:m}:{x:Q(p)?null:a.scale(p),y:rt({axis:n,ticks:o,bandSize:s,entry:m,index:f}),value:p,payload:m}});return S({points:l,layout:h},d)});var le=qt({chartName:"LineChart",GraphicalChild:B,axisComponents:[{axisType:"xAxis",AxisComp:ht},{axisType:"yAxis",AxisComp:zt}],formatAxisMap:Ht});async function ue(t){try{return await q(`${z}/invest/add-stock`,"POST",t)}catch(e){throw console.log(e),e}}async function de(){try{return{data:await q(`${z}/invest/see-stocks`,"GET")}}catch(t){throw console.log(t),t}}async function pe(){try{return{data:await q(`${z}/invest/`,"GET")}}catch(t){throw console.log(t),t}}async function me(t){try{return await q(`${z}/invest/sell-stock`,"PATCH",t)}catch(e){throw console.log(e),e}}function fe(){const t=ct(),{isPending:e,mutate:a}=lt({mutationFn:n=>me(n),onSuccess:()=>{U.success("Stocks sold successfully",{className:"toast"}),t.invalidateQueries({queryKey:["stocks"]})},onError:n=>U.error(n.message,{className:"toast"})});return{isSelling:e,sellStock:a}}function et(){const{data:t,isLoading:e,refetch:a}=nt({queryKey:["stocks"],queryFn:de}),{data:n,isLoading:r}=nt({queryKey:["availableStocks"],queryFn:pe}),o=t==null?void 0:t.data,i=n==null?void 0:n.data;return{stocks:o,loading:e||r,availableStocks:i,refetchStocks:a}}function he(t,e,a){const{availableStocks:n}=et(),r=n==null?void 0:n.find(s=>s._id===t),o=r?e*r.currentValue>e*a:!1,i=r&&e*r.currentValue;return{stock:r,profit:o,profitAmount:i}}function ve({amount:t,boughtPrice:e,i:a,stockId:n,cardId:r,sellPriceId:o,name:i}){const{isSelling:s,sellStock:u}=fe(),{t:d}=tt(),h=d("invest"),{stock:l,profit:m,profitAmount:f}=he(o,t,e),p={amount:t,_id:n,sellPrice:l==null?void 0:l.currentValue,cardId:r};function v(){u(p)}return c.jsxs("div",{className:"transaction-table-row",children:[c.jsx("p",{className:"transaction-table-row-item",children:i}),c.jsx("p",{className:`transaction-table-row-item ${m?"text-green":"text-red"}`,children:t}),c.jsx("p",{className:"transaction-table-row-item",children:e}),c.jsx("p",{className:"transaction-table-row-item",children:l?f==null?void 0:f.toFixed(2):"N/A"}),c.jsx("div",{className:"transaction-table-row-item",children:c.jsx("button",{className:"btn",onClick:v,disabled:s,children:h.ownedStocks.sellAll})})]},a)}const ye=["Name","Amount","Bought Price","Sell Price","Sell"],ge="Please buy a stock";function be(){const{t}=tt(),{options:e,ownedStocks:a}=t("invest"),{sortAmount:n,sortBoughtPrice:r,sortName:o}=e,i=Et(ye,a);return{SORT_OPTIONS:[{value:"amount-asc",label:`${n} (A-Z)`},{value:"amount-desc",label:`${n} (Z-A)`},{value:"name-asc",label:`${o} (A-Z)`},{value:"name-desc",label:`${o} (Z-A)`},{value:"boughtPrice-asc",label:`${r} (A-Z)`},{value:"boughtPrice-desc",label:`${r} (Z-A)`}],rowTranslated:i}}function xe(){const[t]=At(),{stocks:e,loading:a}=et(),n=t.get("sortBy")||"amount-asc",[r,o]=n.split("-"),{SORT_OPTIONS:i,rowTranslated:s}=be(),u=wt(e,a,ge),d=Nt(e,r,o),h=ut(dt);return c.jsxs("div",{className:"transaction-table transaction-table-invest",children:[c.jsx(_t,{title:"Owned stocks",options:i}),c.jsx("div",{className:"transaction-table-row",children:s.map(l=>c.jsx("div",{className:"transaction-table-row-item",children:l},l))}),u,d==null?void 0:d.map((l,m)=>c.jsx(ve,{amount:l.amount,i:m,boughtPrice:l.boughtPrice,stockId:l._id,cardId:h._id,sellPriceId:l.stockId,name:l.name},m))]})}const Ae=-30,Se=1800,je="#8884d8";function Pe(t){return t.previousValue.slice(Ae).map((a,n)=>({previousValue:a,index:n+1}))}function Oe({data:t}){const e=It(Se),a=Pe(t);return c.jsx("div",{className:"stock-line-chart",children:c.jsx(Zt,{width:e?350:"100%",height:e?200:"100%",children:c.jsxs(le,{data:a,children:[c.jsx(ht,{dataKey:"index"}),c.jsx(Gt,{}),c.jsx(B,{type:"monotone",dataKey:"previousValue",stroke:je})]})})})}function ke(){const t=ct(),{isPending:e,mutate:a}=lt({mutationFn:n=>ue(n),onSuccess:()=>{U.success("Use them wisely",{className:"toast"}),t.invalidateQueries({queryKey:["stocks"]})},onError:n=>U.error(n.message,{className:"toast"})});return{isAdding:e,buyStock:a}}const J={AMOUNT:"amount"},we=Ot({[J.AMOUNT]:kt().min(1,{message:"Required"})});function Ne({_id:t,name:e,currentValue:a}){const n=ut(dt),r=pt(),{isAdding:o,buyStock:i}=ke(),{FIELD_LABEL:s}=Tt(),{register:u,handleSubmit:d,watch:h,formState:{errors:l}}=St({defaultValues:{[J.AMOUNT]:""},resolver:jt(we)}),[m]=h(["amount"]),f=+m,p=f*a>n.balance,v=y=>{console.log(y);const x={amount:+y.amount,_id:t,name:e,boughtPrice:a,cardId:n._id};i(x),r(G({modalId:"stock",open:!1}))},b=[{name:J.AMOUNT,label:s.AMOUNT,type:"number"}];return c.jsxs("div",{children:[c.jsx("div",{className:"card-transactions-container",children:c.jsx(mt,{})}),c.jsxs("form",{className:"form-transactions",onSubmit:d(v),children:[b.map((y,x)=>c.jsx(Pt,{id:y.name,name:y.name,register:u,errors:l,placeholder:y.label,type:y.type},x)),c.jsx("div",{className:"form-stocks",children:c.jsx("span",{className:f*a>n.balance?"form-error":void 0,children:f>0&&`Invest ${(f*a).toFixed(2)}$ in ${e}`})}),c.jsx("div",{className:"form-btn",children:c.jsx("button",{className:"btn btn-form",disabled:!n._id||o||p,children:"Invest"})})]})]})}function _e({currentValue:t,name:e,previousValue:a,_id:n}){const r=pt(),[o,i]=st.useState(!1),{t:s}=tt(),u=s("invest");function d(){i(!0),r(G({modalId:"stock",open:!0}))}function h(){i(!1),r(G({modalId:"stock",open:!1}))}return c.jsxs("div",{className:"invest-card",children:[c.jsx(Oe,{data:{previousValue:a}}),c.jsxs("div",{className:"invest-data",children:[c.jsx("div",{className:"invest-card-description",children:c.jsx("h3",{children:e})}),c.jsx("div",{className:"invest-card-amount",children:c.jsxs("span",{children:[u.modal.currentValue," ",t]})}),c.jsx("button",{className:"btn btn-login",onClick:d,children:"Invest"})]}),o&&c.jsx(Dt,{modalId:"stock",handleCloseModal:h,children:c.jsx(Ne,{_id:n,name:e,currentValue:t})})]})}function Te(){const{availableStocks:t}=et();return c.jsx("div",{className:"stocks-container",children:t==null?void 0:t.map(e=>c.jsx(_e,{currentValue:e.currentValue,previousValue:e.previousValue,changePercent:e.changePercent,name:e.name,_id:e._id},e.name))})}function Me(){return c.jsx("div",{className:"main-page-container",children:c.jsxs("div",{className:"main-page",children:[c.jsx(mt,{}),c.jsx(xe,{}),c.jsx(Te,{})]})})}export{Me as default};
