import{R as y,r as J,l as z,m as U,d as ot,e as st,_ as R,k as et,j as c,b as bt,f as ct,g as lt,u as ut,I as xt,t as G}from"./index-HCKIR5Z2.js";import{s as At,S as St,M as jt}from"./Modal-zfOw5dxf.js";import{u as Pt,a as dt}from"./Card-zB8kLOIc.js";import{k as kt,e as Ot,r as nt,D as wt,F as Nt,L as Z,j as W,l as _t,A as Dt,n as B,q as Et,o as Q,s as Ct,t as It,G as Lt,v as pt,x as rt,H as Tt,y as Ft,X as ft,Y as Bt,z as Mt,R as Rt,T as $t}from"./generateCategoricalChart-mGlYHkxR.js";var Kt=["type","layout","connectNulls","ref"];function D(t){"@babel/helpers - typeof";return D=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(t)}function Vt(t,e){if(t==null)return{};var r=Wt(t,e),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(a=0;a<i.length;a++)n=i[a],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function Wt(t,e){if(t==null)return{};var r={},n=Object.keys(t),a,i;for(i=0;i<n.length;i++)a=n[i],!(e.indexOf(a)>=0)&&(r[a]=t[a]);return r}function M(){return M=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},M.apply(this,arguments)}function at(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function b(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?at(Object(r),!0).forEach(function(n){A(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):at(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function _(t){return Ht(t)||Ut(t)||zt(t)||qt()}function qt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zt(t,e){if(t){if(typeof t=="string")return X(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return X(t,e)}}function Ut(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Ht(t){if(Array.isArray(t))return X(t)}function X(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Zt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function it(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,mt(n.key),n)}}function Gt(t,e,r){return e&&it(t.prototype,e),r&&it(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Qt(t,e,r){return e=q(e),Xt(t,ht()?Reflect.construct(e,r||[],q(t).constructor):e.apply(t,r))}function Xt(t,e){if(e&&(D(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return k(t)}function ht(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ht=function(){return!!t})()}function q(t){return q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},q(t)}function k(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yt(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Y(t,e)}function Y(t,e){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Y(t,e)}function A(t,e,r){return e=mt(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function mt(t){var e=Jt(t,"string");return D(e)=="symbol"?e:String(e)}function Jt(t,e){if(D(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(D(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var $=function(t){Yt(e,t);function e(){var r;Zt(this,e);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return r=Qt(this,e,[].concat(a)),A(k(r),"state",{isAnimationFinished:!0,totalLength:0}),A(k(r),"generateSimpleStrokeDasharray",function(o,s){return"".concat(s,"px ").concat(o-s,"px")}),A(k(r),"getStrokeDasharray",function(o,s,l){var u=l.reduce(function(S,P){return S+P});if(!u)return r.generateSimpleStrokeDasharray(s,o);for(var f=Math.floor(o/u),h=o%u,d=s-o,m=[],p=0,v=0;p<l.length;v+=l[p],++p)if(v+l[p]>h){m=[].concat(_(l.slice(0,p)),[h-v]);break}var x=m.length%2===0?[0,d]:[d];return[].concat(_(e.repeat(l,f)),_(m),x).map(function(S){return"".concat(S,"px")}).join(", ")}),A(k(r),"id",kt("recharts-line-")),A(k(r),"pathRef",function(o){r.mainCurve=o}),A(k(r),"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),A(k(r),"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return Gt(e,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var i=this.props,o=i.points,s=i.xAxis,l=i.yAxis,u=i.layout,f=i.children,h=Nt(f,Tt);if(!h)return null;var d=function(v,x){return{x:v.x,y:v.y,value:v.value,errorVal:pt(v.payload,x)}},m={clipPath:n?"url(#clipPath-".concat(a,")"):null};return y.createElement(Z,m,h.map(function(p){return y.cloneElement(p,{key:"bar-".concat(p.props.dataKey),data:o,xAxis:s,yAxis:l,layout:u,dataPointFormatter:d})}))}},{key:"renderDots",value:function(n,a,i){var o=this.props.isAnimationActive;if(o&&!this.state.isAnimationFinished)return null;var s=this.props,l=s.dot,u=s.points,f=s.dataKey,h=W(this.props,!1),d=W(l,!0),m=u.map(function(v,x){var S=b(b(b({key:"dot-".concat(x),r:3},h),d),{},{value:v.value,dataKey:f,cx:v.x,cy:v.y,index:x,payload:v.payload});return e.renderDotItem(l,S)}),p={clipPath:n?"url(#clipPath-".concat(a?"":"dots-").concat(i,")"):null};return y.createElement(Z,M({className:"recharts-line-dots",key:"dots"},p),m)}},{key:"renderCurveStatically",value:function(n,a,i,o){var s=this.props,l=s.type,u=s.layout,f=s.connectNulls;s.ref;var h=Vt(s,Kt),d=b(b(b({},W(h,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:a?"url(#clipPath-".concat(i,")"):null,points:n},o),{},{type:l,layout:u,connectNulls:f});return y.createElement(_t,M({},d,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,a){var i=this,o=this.props,s=o.points,l=o.strokeDasharray,u=o.isAnimationActive,f=o.animationBegin,h=o.animationDuration,d=o.animationEasing,m=o.animationId,p=o.animateNewValues,v=o.width,x=o.height,S=this.state,P=S.prevPoints,E=S.totalLength;return y.createElement(Dt,{begin:f,duration:h,isActive:u,easing:d,from:{t:0},to:{t:1},key:"line-".concat(m),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(w){var j=w.t;if(P){var C=P.length/s.length,O=s.map(function(g,H){var T=Math.floor(H*C);if(P[T]){var F=P[T],N=B(F.x,g.x),vt=B(F.y,g.y);return b(b({},g),{},{x:N(j),y:vt(j)})}if(p){var yt=B(v*2,g.x),gt=B(x/2,g.y);return b(b({},g),{},{x:yt(j),y:gt(j)})}return b(b({},g),{},{x:g.x,y:g.y})});return i.renderCurveStatically(O,n,a)}var K=B(0,E),I=K(j),L;if(l){var V="".concat(l).split(/[,\s]+/gim).map(function(g){return parseFloat(g)});L=i.getStrokeDasharray(I,E,V)}else L=i.generateSimpleStrokeDasharray(E,I);return i.renderCurveStatically(s,n,a,{strokeDasharray:L})})}},{key:"renderCurve",value:function(n,a){var i=this.props,o=i.points,s=i.isAnimationActive,l=this.state,u=l.prevPoints,f=l.totalLength;return s&&o&&o.length&&(!u&&f>0||!Et(u,o))?this.renderCurveWithAnimation(n,a):this.renderCurveStatically(o,n,a)}},{key:"render",value:function(){var n,a=this.props,i=a.hide,o=a.dot,s=a.points,l=a.className,u=a.xAxis,f=a.yAxis,h=a.top,d=a.left,m=a.width,p=a.height,v=a.isAnimationActive,x=a.id;if(i||!s||!s.length)return null;var S=this.state.isAnimationFinished,P=s.length===1,E=nt("recharts-line",l),w=u&&u.allowDataOverflow,j=f&&f.allowDataOverflow,C=w||j,O=Q(x)?this.id:x,K=(n=W(o,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},I=K.r,L=I===void 0?3:I,V=K.strokeWidth,g=V===void 0?2:V,H=Ct(o)?o:{},T=H.clipDot,F=T===void 0?!0:T,N=L*2+g;return y.createElement(Z,{className:E},w||j?y.createElement("defs",null,y.createElement("clipPath",{id:"clipPath-".concat(O)},y.createElement("rect",{x:w?d:d-m/2,y:j?h:h-p/2,width:w?m:m*2,height:j?p:p*2})),!F&&y.createElement("clipPath",{id:"clipPath-dots-".concat(O)},y.createElement("rect",{x:d-N/2,y:h-N/2,width:m+N,height:p+N}))):null,!P&&this.renderCurve(C,O),this.renderErrorBar(C,O),(P||o)&&this.renderDots(C,F,O),(!v||S)&&It.renderCallByParent(this.props,s))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:a.curPoints}:n.points!==a.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,a){for(var i=n.length%2!==0?[].concat(_(n),[0]):n,o=[],s=0;s<a;++s)o=[].concat(_(o),_(i));return o}},{key:"renderDotItem",value:function(n,a){var i;if(y.isValidElement(n))i=y.cloneElement(n,a);else if(Ot(n))i=n(a);else{var o=nt("recharts-line-dot",n?n.className:"");i=y.createElement(wt,M({},a,{className:o}))}return i}}]),e}(J.PureComponent);A($,"displayName","Line");A($,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Lt.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});A($,"getComposedData",function(t){var e=t.props,r=t.xAxis,n=t.yAxis,a=t.xAxisTicks,i=t.yAxisTicks,o=t.dataKey,s=t.bandSize,l=t.displayedData,u=t.offset,f=e.layout,h=l.map(function(d,m){var p=pt(d,o);return f==="horizontal"?{x:rt({axis:r,ticks:a,bandSize:s,entry:d,index:m}),y:Q(p)?null:n.scale(p),value:p,payload:d}:{x:Q(p)?null:r.scale(p),y:rt({axis:n,ticks:i,bandSize:s,entry:d,index:m}),value:p,payload:d}});return b({points:h,layout:f},u)});var te=Ft({chartName:"LineChart",GraphicalChild:$,axisComponents:[{axisType:"xAxis",AxisComp:ft},{axisType:"yAxis",AxisComp:Bt}],formatAxisMap:Mt});async function ee(t){try{return await z(`${U}/invest/add-stock`,"POST",t)}catch(e){throw console.log(e),e}}async function ne(){try{return{data:await z(`${U}/invest/see-stocks`,"GET")}}catch(t){throw console.log(t),t}}async function re(){try{return{data:await z(`${U}/invest/`,"GET")}}catch(t){throw console.log(t),t}}async function ae(t){try{return await z(`${U}/invest/sell-stock`,"PATCH",t)}catch(e){throw console.log(e),e}}function ie(){const t=ot(),{isPending:e,mutate:r}=st({mutationFn:n=>ae(n),onSuccess:()=>{R.success("Stocks sold successfully",{className:"toast"}),t.invalidateQueries({queryKey:["stocks"]})},onError:n=>R.error(n.message,{className:"toast"})});return{isSelling:e,sellStock:r}}function tt(){const{data:t,isLoading:e,refetch:r}=et({queryKey:["stocks"],queryFn:ne}),{data:n,isLoading:a}=et({queryKey:["availableStocks"],queryFn:re}),i=t==null?void 0:t.data,o=n==null?void 0:n.data;return{stocks:i,loading:e||a,availableStocks:o,refetchStocks:r}}function oe(t,e,r){const{availableStocks:n}=tt(),a=n==null?void 0:n.find(s=>s._id===t),i=a?e*a.currentValue>e*r:!1,o=a&&e*a.currentValue;return{stock:a,profit:i,profitAmount:o}}function se({amount:t,boughtPrice:e,i:r,stockId:n,cardId:a,sellPriceId:i,name:o}){const{isSelling:s,sellStock:l}=ie(),{stock:u,profit:f,profitAmount:h}=oe(i,t,e),d={amount:t,_id:n,sellPrice:u==null?void 0:u.currentValue,cardId:a};function m(){l(d)}return c.jsxs("div",{className:"transaction-table-row",children:[c.jsx("p",{className:"transaction-table-row-item",children:o}),c.jsx("p",{className:`transaction-table-row-item ${f?"text-green":"text-red"}`,children:t}),c.jsx("p",{className:"transaction-table-row-item",children:e}),c.jsx("p",{className:"transaction-table-row-item",children:u==null?void 0:u.currentValue}),c.jsx("div",{className:"transaction-table-row-item",children:c.jsxs("button",{className:"btn",onClick:m,disabled:s,children:["Sell for ",u?h==null?void 0:h.toFixed(2):"N/A"]})})]},r)}const ce=["Name","Amount","Bought Price","Sell Price","Sell"],le=[{value:"amount-asc",label:"Sort by amount (A-Z)"},{value:"amount-desc",label:"Sort by amount (Z-A)"},{value:"name-asc",label:"Sort by name (A-Z)"},{value:"name-desc",label:"Sort by name (Z-A)"},{value:"boughtPrice-asc",label:"Sort by bought price (A-Z)"},{value:"boughtPrice-desc",label:"Sort by bought price (Z-A)"}];function ue(){const[t]=bt(),{stocks:e}=tt(),r=t.get("sortBy")||"amount-asc",[n,a]=r.split("-"),i=At(e,n,a),o=ct(lt);return c.jsxs("div",{className:"transaction-table transaction-table-invest",children:[c.jsx(St,{title:"Owned stocks",options:le}),c.jsx("div",{className:"transaction-table-row",children:ce.map(s=>c.jsx("div",{className:"transaction-table-row-item",children:s},s))}),(e==null?void 0:e.length)===0&&c.jsx("div",{className:"empty-page",children:"Please buy a stock"}),i==null?void 0:i.map((s,l)=>c.jsx(se,{amount:s.amount,i:l,boughtPrice:s.boughtPrice,stockId:s._id,cardId:o._id,sellPriceId:s.stockId,name:s.name},l))]})}const de=-30,pe=1800,fe="#8884d8";function he(t){return t.previousValue.slice(de).map((r,n)=>({previousValue:r,index:n+1}))}function me({data:t}){const e=Pt(pe),r=he(t);return c.jsx("div",{className:"stock-line-chart",children:c.jsx(Rt,{width:e?350:"100%",height:e?200:"100%",children:c.jsxs(te,{data:r,children:[c.jsx(ft,{dataKey:"index"}),c.jsx($t,{}),c.jsx($,{type:"monotone",dataKey:"previousValue",stroke:fe})]})})})}function ve(){const t=ot(),{isPending:e,mutate:r}=st({mutationFn:n=>ee(n),onSuccess:()=>{R.success("Use them wisely",{className:"toast"}),t.invalidateQueries({queryKey:["stocks"]})},onError:n=>R.error(n.message,{className:"toast"})});return{isAdding:e,buyStock:r}}function ye({_id:t,name:e,currentValue:r}){const[n,a]=J.useState(""),i=ct(lt),o=ut(),{isAdding:s,buyStock:l}=ve(),u={_id:t,name:e,boughtPrice:r,amount:+n,cardId:i._id},f=+n;console.log(u);async function h(d){if(d.preventDefault(),f*r>i.balance){R.error("Insufficient funds",{className:"toast"});return}l(u),o(G({modalId:"stock",open:!1}))}return c.jsxs("div",{children:[c.jsx("div",{className:"card-transactions-container",children:c.jsx(dt,{})}),c.jsxs("form",{className:"form-transactions",onSubmit:d=>h(d),children:[c.jsx(xt,{type:"number",id:"amount",value:n,onChange:d=>a(d.target.value)}),c.jsx("div",{className:"form-stocks",children:c.jsx("span",{className:f*r>i.balance?"form-error":void 0,children:f>0&&`Invest ${(f*r).toFixed(2)}$ in ${e}`})}),c.jsx("div",{className:"form-btn",children:c.jsx("button",{className:"btn btn-form",disabled:!i._id||s,children:"Invest"})})]})]})}function ge({currentValue:t,name:e,previousValue:r,_id:n}){const a=ut(),[i,o]=J.useState(!1);function s(){o(!0),a(G({modalId:"stock",open:!0}))}function l(){o(!1),a(G({modalId:"stock",open:!1}))}return c.jsxs("div",{className:"invest-card",children:[c.jsx(me,{data:{previousValue:r}}),c.jsxs("div",{className:"invest-data",children:[c.jsx("div",{className:"invest-card-description",children:c.jsx("h3",{children:e})}),c.jsx("div",{className:"invest-card-amount",children:c.jsxs("span",{children:["Current value ",t]})}),c.jsx("button",{className:"btn btn-login",onClick:s,children:"Invest"})]}),i&&c.jsx(jt,{modalId:"stock",handleCloseModal:l,children:c.jsx(ye,{_id:n,name:e,currentValue:t})})]})}function be(){const{availableStocks:t}=tt();return c.jsx("div",{className:"stocks-container",children:t==null?void 0:t.map(e=>c.jsx(ge,{currentValue:e.currentValue,previousValue:e.previousValue,changePercent:e.changePercent,name:e.name,_id:e._id},e.name))})}function Pe(){return c.jsxs("div",{className:"main-page",children:[c.jsx(dt,{}),c.jsx(ue,{}),c.jsx(be,{})]})}export{Pe as default};
